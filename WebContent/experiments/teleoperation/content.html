<div id="container" ng-controller="InitDevices" style="background-image: url(images/Template.jpg);height:760px">
	<div id="reference_focuser"></div>
	<div id="focus_marker">
		<div id="focus_marker_info">0</div>
	</div>
	<div id="left_controls">
		<div id="surveillance_panel" ng-controller="GetCamerasCtrl">
		</div>
	</div>
	<div id="right_controls" ng-controller="MountDevice">
		<div id="mount_target_parameters">
			<span class="title">{{'telexp.mount.title' | i18n}}</span>
			<table style="position:relative;left:10px">
				<tr>
					<td><span class="regular">{{'telexp.mount.ra' | i18n}}:</span></td>
					<td><input id="coords_ra" class="input_text" ng-model="ra" size="6"></input></td>
				</tr>
				<tr>
					<td><span class="regular">{{'telexp.mount.dec' | i18n}}:</span></td>
					<td><input id="coords_dec" class="input_text" ng-model="dec" size="6"></input></td>
				</tr>
				<tr>
					<td><span class="regular">{{'telexp.mount.object' | i18n}}: </span></td>
					<td><input id="tags" class="input_text" ng-model="target_name" size="6"></input></td>
				</tr>
			</table>
			<div align="center" class="status">
				<span class="status_text">READY</span>
			</div>
			<div id="mount_buttons_panel" style="float:right;">
				<button class="button_style"  ng-click="go()" ><span class="button_text">GO</span></button>
			</div>				
		</div>
		<div id="hand_controller_pad" style="position: absolute;top: -30px;left: 55px;">
			<table>
				<tr>
					<td></td>
					<td>
						<div class="arrow_up"></div>
					</td>
					<td></td>
				</tr>
				<tr>
					<td>
						<div class="arrow_left"></div>
					</td>
					<td></td>
					<td>
						<div class="arrow_right"></div>
					</td>						
				</tr>
				<tr>
						<td></td>
						<td>
							<div class="arrow_down"></div>
						</td>
						<td></td>
				</tr>						
			</table>
		</div>
		<div id="main_ccd_panel" ng-controller="CcdDevice" ng-init="ccd_alarm=false">
				<div style="display:block;">
					<span class="title">CCD</span>
					<a id="ccd_alert" href="#">
					<span id="ccd_budge" class="badge badge-important" ng-show="ccd_alarm" ng-mouseleave="ccd_alarm=false">0</span>
					</a>
					<img src="experiments/teleoperation/images/information.png"/>
				</div>
				<div id="main_ccd_parameters">
					<div>
						<table style="position:relative;left:10px">
							<tr>
								<td><span class="regular">{{'telexp.ccd.exposure_time' | i18n}}:</span></td>
								<td><input id="exposure_time" class="input_text" size="6" ng-model="exposure_time"></td>
							</tr>
							<tr>
								<td><span class="regular">{{'telexp.ccd.filter' | i18n}}:</span></td>
								<td>
									<select id="filter_selector" class="selector" ng-model="filter" ng-change="setFilter()">
										<option ng-repeat="filter in filters_0">{{filter}}</option>
									</select>
								</td>
							</tr>
							<tr>
								<td><span class="regular">{{'telexp.ccd.binning' | i18n}}:</span></td>
								<td><select id="binning_selector" class="selector" ng-model="binning" ng-init="binning='1x1'"><option>1x1</option></select></td>
							</tr>
						</table>
					</div>
					<div align="center" class="status" ng-model="status_main_ccd" ng-init="status_main_ccd='telexp.ccd.status.ready'">
						<span id="ccd_status" class="status_text">{{status_main_ccd | i18n}}</span>
					</div>
					<div id="main_ccd_buttons_panel" style="float:right;">
						<button id="expose_0_button"class="button_style" ng-click="expose()"><span class="button_text">START</span></button>
					</div>
				</div>
			</div>
			
	</div>
	 
	 <div id="ccd_button_1" class="ccd_button" style="position:relative;left:250px;width:40px;top:-120px" ng-controller="CcdDevice" ng-click="setOrder(1)">
		CCD1
	</div>
	<div id="ccd_button_0" class="ccd_button_selected" ng-init="ccd_order=0" style="position:relative;top:-150px;left:710px;width:40px;" ng-controller="CcdDevice" ng-click="setOrder(0)">
		CCD0
	</div>
  
	<!-- <div style="width:500px;position:absolute;top:80px;left:270px;"> -->  
		
		<div id="main_image">
		<!--
			<div id="loading" style="text-align:center;position:absolute;top:210px;left:125px;visibility:hidden">
				<img src="experiments/teleoperation/images/init_loading.gif" width="256px" height="30px"/> 
			</div>
					-->
			<div id="main_image_container" style="margin-left:0px">
				<img id="image_0" class="main_img" src="experiments/teleoperation/images/nebulosa_tarantula.jpeg"/>	
			</div> 
		</div>

	  <!-- </div>  -->   
	   
	<div id="gloria_info">
		<div id="weather_station" ng-controller="WeatherDevice" style="width:400px;margin:0 auto;">

			<div style="float:left; display:inline-block;width:33%">
				<div style="float:left">
					<img height="32px" width="32px" src="experiments/teleoperation/images/humidity.png"/>
				</div>
				<div class="weather_condition_value">
					<label class="no_alarm" id="humidity">--- % RH</label>
				</div>
			</div>
			<div style="float:left; display:inline-block;width:33%">
				<div style="float:left">
					<img height="32px" width="32px" src="experiments/teleoperation/images/wind.png"/>
				</div>
				<div class="weather_condition_value">
					<label class="no_alarm" id="velocity">--- m/s</label>
				</div>
			</div>
			<div style="float:left; display:inline-block;width:33%">
				<div style="float:left">
					<img height="32px" width="32px" src="experiments/teleoperation/images/temperature.png"/>
				</div>
				<div class="weather_condition_value">
					<label class="no_alarm" id="temperature">--- Deg. M</label>
				</div>
			</div>
		</div>
	</div>
	 
	<div class="image_carousel" ng-controller="ImageCarousel">
		<div id="foo2">
		</div>
		<div class="clearfix"></div>
		<a class="prev" id="foo1_prev" href="#"><span>prev</span></a>
		<a class="next" id="foo1_next" href="#"><span>next</span></a> 
	</div>
		 
</div>
<script>
var dragged = false;
var initFocuserPosition = 0;
var finalFocuserPosition = 1000;
var currentFocuserPosition = 0;

$('#focus_marker').on('mouseenter', function(e){
	$('#focus_marker_info').text(currentFocuserPosition);
	$('#focus_marker_info').css("visibility","visible");
});

$('#focus_marker').on('mouseleave', function(e){
	if (!dragged){
		$('#focus_marker_info').css("visibility","hidden");		
	}
});
$('#focus_marker').on('mousedown', function(e){
	
	var movementDirection = 0;  //Undefined
	var lastRotateDegree = 0;
	var rotateDegree = 0;
	
	var limitClockwiseDirection = false;
	var limitCounterClockwiseDirection = false;


	dragged = true;
	
	$('#focus_marker').css("opacity","0.8");

	e.originalEvent.preventDefault();

    $(window).mousemove(function(event){
        var rotateOriginalDegree = rotateAnnotationCropper($('#main_image').parent(), event.pageX,event.pageY, $('#focus_marker'));
        
        if ((rotateOriginalDegree < 270) && (rotateOriginalDegree > 180)){
        	rotateDegree = rotateOriginalDegree - 360;
        } else {
        	rotateDegree = rotateOriginalDegree;
        }
        
        var rotate = 'rotate(' +rotateOriginalDegree + 'deg)';
		var rotateInfo = 'rotate(' +(-1)*rotateOriginalDegree + 'deg)';

		$('#focus_marker').css({'-moz-transform': rotate, 'transform' : rotate, '-webkit-transform': rotate, '-ms-transform': rotate});
		$("#focus_marker_info").css({'-moz-transform': rotateInfo, 'transform' : rotateInfo, '-webkit-transform': rotateInfo, '-ms-transform': rotateInfo});
		     
         currentFocuserPosition = initFocuserPosition + parseInt(rotateDegree*((finalFocuserPosition - initFocuserPosition) / 180));
         $('#focus_marker_info').text(currentFocuserPosition);    
        
    });
		
    $(window).mouseup(function(event){ 

    	if (dragged){
    		
    		$(window).unbind('mousemove');
    		console.log("Moving focuser:"+$("#focus_marker_info").text());
  
			/*
    		GlAPI.setParameterTreeValue(<%= reservationId %>,'focuser','position',currentFocuserPosition,function(success){

 			}, function(error){

 			});
			*/
    		$('#focus_marker').css("opacity","1.0");		
    		dragged = false;
    	}
    	
    });
		
    
});   

$("#coords_ra").keyup('keyup', function(e){
	var text = $(this).val();
	if(text==""){
		if($("#coords_dec").val()==""){
			$("#tags").removeAttr("disabled");
		}
	} else {
		if($("#tags").val()==""){
			$("#tags").attr("disabled",true);	
		}
	}

});
$("#coords_dec").bind('keyup', function(e){
	if($(this).val()==""){
		if($("#coords_ra").val()==""){
			$("#tags").removeAttr("disabled");
		}
	} else {
		if($("#tags").val()==""){
			$("#tags").attr("disabled",true);	
		}
	}
});
$("#tags").bind('keyup', function(e){
	if($(this).val()==""){
		$("#coords_ra").removeAttr("disabled");
		$("#coords_dec").removeAttr("disabled");
	} else {
		if ($("#coords_ra").val()=="" && $("#coords_dec").val()==""){
			$("#coords_ra").attr("disabled",true);
			$("#coords_dec").attr("disabled",true);		
		}
	}
});
$("#ccd_alert").tooltip({
	show: {
		 effect: "slideDown",
	     delay: 250
	}
});
</script>